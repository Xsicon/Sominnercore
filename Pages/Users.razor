@page "/admin/users"
@layout Sominnercore.Layout.AdminLayout
@using System.Linq
@using Microsoft.AspNetCore.Components.Web

<DashboardHeader Title="User Management" 
                 Subtitle="Manage team members and permissions" />

<div class="users-page">
    <section class="users-status">
        <div class="user-stat-card user-stat-card-total">
            <div class="user-stat-info">
                <span class="user-stat-label">Total Users</span>
                <span class="user-stat-value">@_totalUsers</span>
            </div>
            <MudIcon Icon="@Icons.Material.Outlined.Person" Class="user-stat-icon" />
        </div>
        <div class="user-stat-card user-stat-card-active">
            <div class="user-stat-info">
                <span class="user-stat-label">Active Users</span>
                <span class="user-stat-value">@_activeUsers</span>
            </div>
            <MudIcon Icon="@Icons.Material.Outlined.Person" Class="user-stat-icon" />
        </div>
        <div class="user-stat-card user-stat-card-inactive">
            <div class="user-stat-info">
                <span class="user-stat-label">Inactive Users</span>
                <span class="user-stat-value">@_inactiveUsers</span>
            </div>
            <MudIcon Icon="@Icons.Material.Outlined.Person" Class="user-stat-icon" />
        </div>
        <div class="user-stat-card user-stat-card-admin">
            <div class="user-stat-info">
                <span class="user-stat-label">Administrators</span>
                <span class="user-stat-value">@_administrators</span>
            </div>
            <MudIcon Icon="@Icons.Material.Outlined.Shield" Class="user-stat-icon" />
        </div>
    </section>

    <section class="users-content">
        <div class="users-filters">
            <div class="users-filters-card">
                <div class="users-search">
                    <MudIcon Icon="@Icons.Material.Filled.Search" Class="users-search-icon" />
                    <input class="users-search-input"
                           placeholder="Search by name or email..."
                           @bind="_searchTerm"
                           @bind:event="oninput" />
                </div>
                <div class="users-filter-buttons">
                    <button class="users-filter-btn" @onclick="ToggleRoleFilter" type="button">
                        <MudIcon Icon="@Icons.Material.Filled.FilterList" Class="users-filter-icon" />
                        <span>@_selectedRole</span>
                    </button>
                    <button class="users-filter-btn" @onclick="ToggleStatusFilter" type="button">
                        <MudIcon Icon="@Icons.Material.Filled.FilterList" Class="users-filter-icon" />
                        <span>@_selectedStatus</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="users-table-container">
            <div class="users-table-card">
                <div class="users-table-header">
                    <h2 class="users-table-title">All Users</h2>
                    <span class="users-count">@FilteredUsers.Count</span>
                </div>
                <div class="users-table-wrapper">
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Created</th>
                                <th>Last Login</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var user in FilteredUsers)
                            {
                                <tr>
                                    <td>
                                        <div class="user-cell">
                                            <div class="user-avatar" style="background: @user.AvatarColor">
                                                @user.Initial
                                            </div>
                                            <span class="user-name">@user.Name</span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="email-cell">
                                            <MudIcon Icon="@Icons.Material.Outlined.Email" Class="email-icon" />
                                            <span>@user.Email</span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="role-badge role-@user.RoleClass">@user.Role</span>
                                    </td>
                                    <td>
                                        <span class="status-badge status-@user.StatusClass">@user.Status</span>
                                    </td>
                                    <td>
                                        <div class="date-cell">
                                            <MudIcon Icon="@Icons.Material.Outlined.CalendarToday" Class="date-icon" />
                                            <span>@user.CreatedDate</span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="date-text">@user.LastLogin</span>
                                    </td>
                                    <td>
                                        <button class="users-action-btn">
                                            <MudIcon Icon="@Icons.Material.Filled.MoreVert" Class="action-icon" />
                                        </button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>
</div>

@code {
    private int _totalUsers = 6;
    private int _activeUsers = 5;
    private int _inactiveUsers = 1;
    private int _administrators = 1;

    private string _searchTerm = string.Empty;
    private string _selectedRole = "All Roles";
    private string _selectedStatus = "All Status";
    private bool ShowRoleFilter = false;
    private bool ShowStatusFilter = false;

    private void ToggleRoleFilter(MouseEventArgs e)
    {
        ShowRoleFilter = !ShowRoleFilter;
    }

    private void ToggleStatusFilter(MouseEventArgs e)
    {
        ShowStatusFilter = !ShowStatusFilter;
    }

    private readonly List<UserViewModel> _users = new()
    {
        new UserViewModel
        {
            Name = "John Admin",
            Email = "john@sominnercore.com",
            Role = "Admin",
            RoleClass = "admin",
            Status = "active",
            StatusClass = "active",
            CreatedDate = "1/15/2025",
            LastLogin = "11/19/2025",
            Initial = "J",
            AvatarColor = "#f97316"
        },
        new UserViewModel
        {
            Name = "Sarah Marketing",
            Email = "sarah@sominnercore.com",
            Role = "Marketing Manager",
            RoleClass = "marketing",
            Status = "active",
            StatusClass = "active",
            CreatedDate = "2/20/2025",
            LastLogin = "11/18/2025",
            Initial = "S",
            AvatarColor = "#f97316"
        },
        new UserViewModel
        {
            Name = "Mike Support",
            Email = "mike@sominnercore.com",
            Role = "Support Specialist",
            RoleClass = "support",
            Status = "active",
            StatusClass = "active",
            CreatedDate = "3/10/2025",
            LastLogin = "11/19/2025",
            Initial = "M",
            AvatarColor = "#22c55e"
        },
        new UserViewModel
        {
            Name = "Emily CRS",
            Email = "emily@sominnercore.com",
            Role = "CRS (Customer Relations Specialist)",
            RoleClass = "crs",
            Status = "active",
            StatusClass = "active",
            CreatedDate = "4/5/2025",
            LastLogin = "11/17/2025",
            Initial = "E",
            AvatarColor = "#f97316"
        },
        new UserViewModel
        {
            Name = "David Developer",
            Email = "david@sominnercore.com",
            Role = "Developer",
            RoleClass = "developer",
            Status = "active",
            StatusClass = "active",
            CreatedDate = "5/12/2025",
            LastLogin = "11/19/2025",
            Initial = "D",
            AvatarColor = "#f97316"
        },
        new UserViewModel
        {
            Name = "Lisa Former",
            Email = "lisa@sominnercore.com",
            Role = "Support Specialist",
            RoleClass = "support",
            Status = "inactive",
            StatusClass = "inactive",
            CreatedDate = "1/8/2025",
            LastLogin = "10/15/2025",
            Initial = "L",
            AvatarColor = "#f97316"
        }
    };

    private List<UserViewModel> FilteredUsers
    {
        get
        {
            return _users.Where(u =>
                (string.IsNullOrWhiteSpace(_searchTerm) ||
                 u.Name.Contains(_searchTerm, StringComparison.OrdinalIgnoreCase) ||
                 u.Email.Contains(_searchTerm, StringComparison.OrdinalIgnoreCase)) &&
                (_selectedRole == "All Roles" || u.Role == _selectedRole) &&
                (_selectedStatus == "All Status" || u.Status == _selectedStatus))
                .ToList();
        }
    }

    private class UserViewModel
    {
        public string Name { get; set; } = string.Empty;
        public string Email { get; set; } = string.Empty;
        public string Role { get; set; } = string.Empty;
        public string RoleClass { get; set; } = string.Empty;
        public string Status { get; set; } = string.Empty;
        public string StatusClass { get; set; } = string.Empty;
        public string CreatedDate { get; set; } = string.Empty;
        public string LastLogin { get; set; } = string.Empty;
        public string Initial { get; set; } = string.Empty;
        public string AvatarColor { get; set; } = string.Empty;
    }
}

